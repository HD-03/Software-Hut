- status_class_mapping = {"completed" => "table-success", "todo" => "table-danger", "pending" => "table-warning"}

.card
  .card-header.text-center
    %h2 Tasks
    %h5 There are #{@tasks.select { |task| task.status == 'todo' }.size} tasks to do
  
  = simple_form_for :search, url: search_tasks_path, method: :post do |f|
    .row.p-3
      .col-md-4
        = f.input :name
      .col-md-4
        - if @user_is_student
          = f.input :teacher_id, as: :select, collection: @tasks.map(&:teacher).uniq.map { |teacher| [teacher.full_name, teacher.id] }
        - elsif @user_is_teacher
          = f.input :student_id, as: :select, collection: @tasks.map(&:student).uniq.map { |student| [student.full_name, student.id] }
        - else
          = f.input :teacher_id, as: :select, collection: @tasks.map(&:teacher).uniq.map { |teacher| [teacher.full_name, teacher.id] }
          = f.input :student_id, as: :select, collection: @tasks.map(&:student).uniq.map { |student| [student.full_name, student.id] }
      .col-md-2.mt-auto
        = f.submit 'Search', class: 'btn btn-outline-secondary'
        = link_to 'Reset', tasks_path, class: 'btn btn-outline-secondary'
  %table.table
    %thead
      %tr
        %th Task
        %th Description
        %th Reward XP
        %th Deadline
        - if @user_is_student
          %th Teacher
        - elsif @user_is_teacher
          %th Student
        - else
          %th Teacher
          %th Student
        %th Status
        %th Template
        %th
    %tbody
      - @tasks.each do |task|
        %tr{ class: status_class_mapping[task.status.to_s] }
          %td= task.name
          %td= task.description
          %td= task.reward_xp
          %td= task.deadline_readable
          - if @user_is_student
            %th= task.teacher.full_name
          - elsif @user_is_teacher
            %th= task.student.full_name
          - else 
            %th= task.teacher.full_name
            %th= task.student.full_name
          %td.align-middle.fs-4
            - if task.status.to_s == "completed"
              %i.bi.bi-check2-all
            - elsif task.status.to_s == "pending"
              %i.bi.bi-check2
            - else
              %i.bi.bi-clock-history
          %td
            .btn-toolbar.float-end
              = link_to 'Use as template', new_task_path(task_id: task.id), class: 'btn btn-outline-secondary btn-sm'

          %td
            .btn-toolbar.float-end
              - if task.status.to_s == "todo"
                = link_to 'Do', '#', class: 'btn btn-outline-secondary btn-sm'
              - else
                = link_to 'View', '#', class: 'btn btn-outline-secondary btn-sm'
